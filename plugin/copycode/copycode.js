(function(h,v){typeof exports=="object"&&typeof module<"u"?module.exports=v():typeof define=="function"&&define.amd?define(v):(h=typeof globalThis<"u"?globalThis:h||self,h.CopyCode=v())})(this,(function(){"use strict";var h=typeof document<"u"?document.currentScript:null;function v(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var A,L;function R(){if(L)return A;L=1;var o=function(i){return e(i)&&!t(i)};function e(s){return!!s&&typeof s=="object"}function t(s){var i=Object.prototype.toString.call(s);return i==="[object RegExp]"||i==="[object Date]"||u(s)}var r=typeof Symbol=="function"&&Symbol.for,n=r?Symbol.for("react.element"):60103;function u(s){return s.$$typeof===n}function f(s){return Array.isArray(s)?[]:{}}function y(s,i){return i.clone!==!1&&i.isMergeableObject(s)?S(f(s),s,i):s}function g(s,i,l){return s.concat(i).map(function(m){return y(m,l)})}function p(s,i){if(!i.customMerge)return S;var l=i.customMerge(s);return typeof l=="function"?l:S}function a(s){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(s).filter(function(i){return Object.propertyIsEnumerable.call(s,i)}):[]}function c(s){return Object.keys(s).concat(a(s))}function C(s,i){try{return i in s}catch{return!1}}function q(s,i){return C(s,i)&&!(Object.hasOwnProperty.call(s,i)&&Object.propertyIsEnumerable.call(s,i))}function $(s,i,l){var m={};return l.isMergeableObject(s)&&c(s).forEach(function(d){m[d]=y(s[d],l)}),c(i).forEach(function(d){q(s,d)||(C(s,d)&&l.isMergeableObject(i[d])?m[d]=p(d,l)(s[d],i[d],l):m[d]=y(i[d],l))}),m}function S(s,i,l){l=l||{},l.arrayMerge=l.arrayMerge||g,l.isMergeableObject=l.isMergeableObject||o,l.cloneUnlessOtherwiseSpecified=y;var m=Array.isArray(i),d=Array.isArray(s),I=m===d;return I?m?l.arrayMerge(s,i,l):$(s,i,l):y(i,l)}S.all=function(i,l){if(!Array.isArray(i))throw new Error("first argument should be an array");return i.reduce(function(m,d){return S(m,d,l)},{})};var b=S;return A=b,A}var U=R();const _=v(U);let T=null;const F=()=>{if(T)return T;const o=typeof window<"u",e=typeof document<"u";let t=!1;try{const n=new Function('return typeof module !== "undefined" && !!module.hot')(),u=new Function('return typeof import.meta !== "undefined" && !!import.meta.hot')();t=n||u}catch{}let r=!1;try{r=new Function('return typeof import.meta !== "undefined" && import.meta.env?.DEV === true')()}catch{}return T={isDevelopment:t||r,hasHMR:t,isViteDev:r,hasWindow:o,hasDocument:e},T};class H{defaultConfig;pluginInit;pluginId;mergedConfig=null;userConfigData=null;data={};constructor(e,t,r){typeof e=="string"?(this.pluginId=e,this.pluginInit=t,this.defaultConfig=r||{}):(this.pluginId=e.id,this.pluginInit=e.init,this.defaultConfig=e.defaultConfig||{})}initializeConfig(e){const t=this.defaultConfig,r=e.getConfig()[this.pluginId]||{};this.userConfigData=r,this.mergedConfig=_(t,r,{arrayMerge:(n,u)=>u,clone:!0})}getCurrentConfig(){if(!this.mergedConfig)throw new Error("Plugin configuration has not been initialized");return this.mergedConfig}getData(){return Object.keys(this.data).length>0?this.data:void 0}get userConfig(){return this.userConfigData||{}}getEnvironmentInfo=()=>F();init(e){if(this.initializeConfig(e),this.pluginInit)return this.pluginInit(this,e,this.getCurrentConfig())}createInterface(e={}){return{id:this.pluginId,init:t=>this.init(t),getConfig:()=>this.getCurrentConfig(),getData:()=>this.getData(),...e}}}const N=o=>{const e=document.querySelector(`script[src$="${o}.js"], script[src$="${o}.min.js"], script[src$="${o}.mjs"]`);if(e?.src){const t=e.getAttribute("src")||"",r=t.lastIndexOf("/");if(r!==-1)return t.substring(0,r+1)}try{if(typeof{url:typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:h&&h.tagName.toUpperCase()==="SCRIPT"&&h.src||new URL("plugin/copycode/copycode.js",document.baseURI).href}<"u"&&(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:h&&h.tagName.toUpperCase()==="SCRIPT"&&h.src||new URL("plugin/copycode/copycode.js",document.baseURI).href))return(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:h&&h.tagName.toUpperCase()==="SCRIPT"&&h.src||new URL("plugin/copycode/copycode.js",document.baseURI).href).slice(0,(typeof document>"u"&&typeof location>"u"?require("url").pathToFileURL(__filename).href:typeof document>"u"?location.href:h&&h.tagName.toUpperCase()==="SCRIPT"&&h.src||new URL("plugin/copycode/copycode.js",document.baseURI).href).lastIndexOf("/")+1)}catch{}return`plugin/${o}/`},E="data-css-id",B=(o,e)=>new Promise((t,r)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,n.setAttribute(E,o);const u=setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),r(new Error(`[${o}] Timeout loading CSS from: ${e}`))},5e3);n.onload=()=>{clearTimeout(u),t()},n.onerror=()=>{clearTimeout(u),n.parentNode&&n.parentNode.removeChild(n),r(new Error(`[${o}] Failed to load CSS from: ${e}`))},document.head.appendChild(n)}),M=o=>document.querySelectorAll(`[${E}="${o}"]`).length>0,W=o=>new Promise(e=>{if(t())return e(!0);setTimeout(()=>{e(t())},50);function t(){if(M(o))return!0;try{return window.getComputedStyle(document.documentElement).getPropertyValue(`--cssimported-${o}`).trim()!==""}catch{return!1}}}),D=async o=>{const{id:e,cssautoload:t=!0,csspath:r="",debug:n=!1}=o;if(t===!1||r===!1)return;if(M(e)&&!(typeof r=="string"&&r.trim()!=="")){n&&console.log(`[${e}] CSS is already loaded, skipping`);return}M(e)&&typeof r=="string"&&r.trim()!==""&&n&&console.log(`[${e}] CSS is already loaded, also loading user-specified path: ${r}`);const u=[];typeof r=="string"&&r.trim()!==""&&u.push(r);const f=N(e);if(f){const g=`${f}${e}.css`;u.push(g)}const y=`plugin/${e}/${e}.css`;u.push(y);for(const g of u)try{await B(e,g);let p="CSS";r&&g===r?p="user-specified CSS":f&&g===`${f}${e}.css`?p="CSS (auto-detected from script location)":p="CSS (standard fallback)",n&&console.log(`[${e}] ${p} loaded successfully from: ${g}`);return}catch{n&&console.log(`[${e}] Failed to load CSS from: ${g}`)}console.warn(`[${e}] Could not load CSS from any location`)};async function k(o,e){if("getEnvironmentInfo"in o&&e){const t=o,r=t.getEnvironmentInfo();if(await W(t.pluginId)&&!(typeof e.csspath=="string"&&e.csspath.trim()!=="")){e.debug&&console.log(`[${t.pluginId}] CSS is already imported, skipping`);return}if("cssautoload"in t.userConfig?e.cssautoload:!r.isDevelopment)return D({id:t.pluginId,cssautoload:!0,csspath:e.csspath,debug:e.debug});r.isDevelopment&&console.warn(`[${t.pluginId}] CSS autoloading is disabled in bundler environments. Please import the CSS manually, using import.`);return}return D(o)}class z{debugMode=!1;label="DEBUG";groupDepth=0;initialize(e,t="DEBUG"){this.debugMode=e,this.label=t}group=(...e)=>{this.debugLog("group",...e),this.groupDepth++};groupCollapsed=(...e)=>{this.debugLog("groupCollapsed",...e),this.groupDepth++};groupEnd=()=>{this.groupDepth>0&&(this.groupDepth--,this.debugLog("groupEnd"))};error=(...e)=>{const t=this.debugMode;this.debugMode=!0,this.formatAndLog(console.error,e),this.debugMode=t};table=(e,t,r)=>{if(this.debugMode)try{typeof e=="string"&&t!==void 0&&typeof t!="string"?(this.groupDepth===0?console.log(`[${this.label}]: ${e}`):console.log(e),r?console.table(t,r):console.table(t)):(this.groupDepth===0&&console.log(`[${this.label}]: Table data`),typeof t=="object"&&Array.isArray(t)?console.table(e,t):console.table(e))}catch(n){console.error(`[${this.label}]: Error showing table:`,n),console.log(`[${this.label}]: Raw data:`,e)}};formatAndLog=(e,t)=>{if(this.debugMode)try{this.groupDepth>0?e.call(console,...t):t.length>0&&typeof t[0]=="string"?e.call(console,`[${this.label}]: ${t[0]}`,...t.slice(1)):e.call(console,`[${this.label}]:`,...t)}catch(r){console.error(`[${this.label}]: Error in logging:`,r),console.log(`[${this.label}]: Original log data:`,...t)}};debugLog(e,...t){const r=console[e];if(!this.debugMode&&e!=="error"||typeof r!="function")return;const n=r;if(e==="group"||e==="groupCollapsed"){t.length>0&&typeof t[0]=="string"?n.call(console,`[${this.label}]: ${t[0]}`,...t.slice(1)):n.call(console,`[${this.label}]:`,...t);return}if(e==="groupEnd"){n.call(console);return}if(e==="table"){t.length===1?this.table(t[0]):t.length===2?typeof t[0]=="string"?this.table(t[0],t[1]):this.table(t[0],t[1]):t.length>=3&&this.table(t[0],t[1],t[2]);return}this.groupDepth>0?n.call(console,...t):t.length>0&&typeof t[0]=="string"?n.call(console,`[${this.label}]: ${t[0]}`,...t.slice(1)):n.call(console,`[${this.label}]:`,...t)}}const V=o=>new Proxy(o,{get:(e,t)=>{if(t in e)return e[t];const r=t.toString();if(typeof console[r]=="function")return(...n)=>{e.debugLog(r,...n)}}}),j=V(new z),w={button:"always",display:"text",text:{copy:"Copy",copied:"Copied!"},plaintextonly:!0,timeout:1e3,style:{copybg:"orange",copiedbg:"green",copycolor:"black",copiedcolor:"white",copyborder:"",copiedborder:"",scale:1,offset:0,radius:0},window:!1,tooltip:!0,iconsvg:{copy:"",copied:""},cssautoload:!0,csspath:""},G=o=>{if(!o||o==="transparent")return"white";const e=o.match(/\d+(\.\d+)?/g);if(!e||e.length<3)return"white";const t=parseFloat(e[0]),r=parseFloat(e[1]),n=parseFloat(e[2]);return Math.sqrt(.299*(t*t)+.587*(r*r)+.114*(n*n))>127.5?"black":"white"},Z=async(o,e)=>{if(e.plaintextonly){let t;const r=o.querySelector("table.hljs-ln");r?t=Array.from(r.querySelectorAll("td.hljs-ln-code")).map(n=>n.textContent).join(`
`):t=o.innerText.replace(/^\s+|\s+$/g,""),await navigator.clipboard.writeText(t)}else try{const t=o.cloneNode(!0);let r;const n=t.querySelector("table.hljs-ln");if(n){const a=n.querySelectorAll("td.hljs-ln-numbers");for(const c of a)c.style.display="none";r=Array.from(n.querySelectorAll("td.hljs-ln-code")).map(c=>c.textContent).join(`
`)}else r=t.innerText;const f=`
				<style>${Array.from(document.styleSheets).flatMap(a=>{try{return Array.from(a.cssRules)}catch{return[]}}).filter(a=>a.cssText.includes(".hljs")||a.cssText.includes("pre code")||a.cssText.includes("code[class")||a.cssText.includes(".language-")||a.cssText.includes("pre")||a.cssText.includes("code")).map(a=>a.cssText).join(`
`)}pre, code, .hljs, .hljs-ln-code { white-space: pre !important; font-family: monospace !important;}</style>
				<div>${t.outerHTML}</div>
			`,y=new Blob([f],{type:"text/html"}),g=new Blob([r],{type:"text/plain"}),p=new ClipboardItem({"text/html":y,"text/plain":g});await navigator.clipboard.write([p])}catch(t){console.error("Rich text clipboard error:",t),await navigator.clipboard.writeText(o.innerText)}},K=(o,e)=>{const t=o.querySelectorAll(".codeblock button[data-cc]:not(.code-copy-button)");for(const r of t)r.addEventListener("click",async()=>{const n=r,f=n.closest(".codeblock")?.querySelector("code");if(!f||!(f instanceof HTMLElement)){j.error("Could not find code element");return}try{await Z(f,e),Y(n,e)}catch(y){j.error("Error copying code:",y)}})},Y=(o,e)=>{o.textholder&&(o.dataset.textOriginal=o.textholder.innerHTML,o.textholder.innerHTML=o.dataset.ccCopied||e.text.copied),o.setAttribute("disabled","true"),setTimeout(()=>{o.textholder&&(o.dataset.ccDisplay!=="icons"||!o.dataset.ccDisplay)&&(o.textholder.innerHTML=o.dataset.textOriginal||""),delete o.dataset.textOriginal,o.removeAttribute("disabled")},e.timeout)},O={copy:'<svg aria-hidden="true" height="16" width="16" viewBox="0 0 16 16" version="1.1"><path d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"></path><path d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"></path></svg>',copied:'<svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16"><path d="M15.7,2.8c0.4,0.4,0.4,1,0,1.4L6,13.9c-0.4,0.4-1,0.4-1.4,0L0.3,9.6c-0.4-0.4-0.4-1,0-1.4c0.4-0.4,1-0.4,1.4,0l3.6,3.6l9-9C14.7,2.4,15.3,2.4,15.7,2.8z"/></svg>'},J=(o,e)=>{const t=e.iconsvg?.copy&&e.iconsvg.copy!==""?e.iconsvg.copy:O.copy,r=e.iconsvg?.copied&&e.iconsvg.copied!==""?e.iconsvg.copied:O.copied,n=o.dataset.ccDisplay||e.display;n==="icons"||n==="both"?(o.innerHTML="<span></span>",o.textholder=o.querySelector("span"),o.insertAdjacentHTML("afterbegin",r),o.insertAdjacentHTML("afterbegin",t),o.dataset.ccDisplay==="icons"&&e.tooltip&&(o.textholder.style.display="flex")):(o.innerHTML="<span></span>",o.textholder=o.querySelector("span")),o.textholder&&(o.textholder.textContent=o.dataset.ccCopy?o.dataset.ccCopy:e.text?.copy||"Copy")},Q=(o,e)=>{const t=(r,n)=>r===void 0||r===""&&String(n)==="0"?!1:String(r)!==String(n);t(e.style.copybg,w.style.copybg)&&o.style.setProperty("--cc-copy-bg",e.style.copybg),t(e.style.copiedbg,w.style.copiedbg)&&o.style.setProperty("--cc-copied-bg",e.style.copiedbg),t(e.style.copycolor,w.style.copycolor)&&o.style.setProperty("--cc-copy-color",e.style.copycolor),t(e.style.copiedcolor,w.style.copiedcolor)&&o.style.setProperty("--cc-copied-color",e.style.copiedcolor),t(e.style.scale,w.style.scale)&&o.style.setProperty("--cc-scale",String(e.style.scale)),t(e.style.offset,w.style.offset)&&o.style.setProperty("--cc-offset",String(e.style.offset)),t(e.style.radius,w.style.radius)&&o.style.setProperty("--cc-radius",String(e.style.radius)),t(e.style.copyborder,w.style.copyborder)&&e.style.copyborder!==""&&o.style.setProperty("--cc-copyborder",e.style.copyborder),t(e.style.copiedborder,w.style.copiedborder)&&e.style.copiedborder!==""&&o.style.setProperty("--cc-copiedborder",e.style.copiedborder)},X=async(o,e)=>{const t=o.getRevealElement(),r='pre:not([data-cc="false"]) > code',u=document.querySelector("[name=generator]")?.getAttribute("content")?.includes("quarto")??!1;let f=[];if(t&&(Q(t,e),f=Array.from(t.querySelectorAll(r)).map(y=>y.parentElement).filter(y=>y instanceof HTMLPreElement)),f.length>0&&t){j.log(`${f.length} code blocks found`,f),t.insertAdjacentHTML("beforeend",'<pre><code class="hljs"></code></pre>');const y=t.lastElementChild,g=getComputedStyle(y.firstElementChild).backgroundColor;if(y.remove(),g){const p=G(g);t.style.setProperty("--cc-code-bg",g),t.style.setProperty("--cc-window-title-color",p)}for(const p of f){let a=null,c=null;const C=p.parentElement;if(u&&C?.matches(".sourceCode")?(a=C,c=a,C.dataset.did="quartoblock"):(c=p,C?.classList.contains("codeblock")||(a=document.createElement("div"),C?.insertBefore(a,p))),a&&c&&(a.classList.add("codeblock"),a.appendChild(p),(e.display==="icon"||e.display==="icons"||e.display==="both")&&c&&(c.dataset.ccDisplay=e.display),p.classList.contains("fragment")&&(a.classList.add("fragment"),p.classList.remove("fragment")),p.querySelectorAll("code")[0]?.innerText)){const $=c.getAttribute("data-cc-button")||(c.dataset.cc!=="false"?c.dataset.cc:null),S=$==="false";let b=null;if(!S){b=document.createElement("button"),b.dataset.cc="true",b.title="Copy to Clipboard";const l=$||e.button;l!=="always"&&(b.dataset.cc=l);const m=["ccCopy","ccCopied","ccDisplay"];for(const d of m)c.dataset[d]&&(b.dataset[d]=c.dataset[d],delete c.dataset[d]);J(b,e)}delete c.dataset.ccButton,c.dataset.cc!=="false"&&delete c.dataset.cc;const s=c.getAttribute("data-cc-window");if(s!=="false"&&(s!==null||e.window!==!1)&&c.dataset.cc!=="false"){const l=c.dataset.ccWindow,m=typeof e.window=="object"?e.window.title:void 0,d=c.getAttribute("data-cc-window-title")??(l&&l!=="true"?l:m??""),I=c.getAttribute("data-cc-window-controls")||(typeof e.window=="object"?e.window.controls:"color"),te=c.getAttribute("data-cc-window-controls-opacity")||(typeof e.window=="object"?e.window.controlsOpacity?.toString()??"1":"1"),oe=c.getAttribute("data-cc-window-padding")||(typeof e.window=="object"?e.window.padding:void 0)||"0.5rem";a.classList.add(`cc-controls-${I}`),a.style.setProperty("--cc-window-controls-opacity",te),a.style.setProperty("--cc-window-padding",oe),delete c.dataset.ccWindow,delete c.dataset.ccWindowTitle,delete c.dataset.ccWindowControls,delete c.dataset.ccWindowControlsOpacity,delete c.dataset.ccWindowPadding;const x=document.createElement("div");x.className="cc-window-bar",x.innerHTML=`
							<div class="cc-window-left"><div class="cc-controls"><span></span><span></span><span></span></div></div>
							<div class="cc-window-title">${d}</div>
							<div class="cc-window-right"></div>
						`,b&&x.querySelector(".cc-window-right")?.appendChild(b),a.dataset.ccWindow="true",a.insertBefore(x,p)}else b&&c.dataset.cc!=="false"&&a.insertBefore(b,p)}}K(t,e)}},P="copycode",ee=async(o,e,t)=>{j&&t.debug&&j.initialize(!0,P),await k(o,t),await X(e,t)};return()=>new H(P,ee,w).createInterface()}));